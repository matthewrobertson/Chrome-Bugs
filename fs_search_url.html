<html>
	<head>
	</head>
	<body>
	<script type='text/javascript'>

	var fail = function() {
		alert('oops');	
	};

	var writeFile = function(path, content, fs, successCallback)  {
			fs.root.getFile(path, { create: true, exclusive: false }, function(fileEntry) {
				fileEntry.createWriter(function(fileWriter) {

					fileWriter.onwriteend = successCallback;

					fileWriter.onerror = fail;

					// Create a new Blob and write it
					var bb = new WebKitBlobBuilder(); 				
					bb.append(content);
					fileWriter.write(bb.getBlob('text/plain'));
					

				}, fail);

			}, fail);
	};

    var buildContent = function() {
        var cont = "<html><head></head><body><scr";
        cont += "ipt type='text/javascript'>"
        cont += "alert('The search string is:' + window.location.search)";
        cont += "</scr";
        cont += "ipt></body></html>";
        return cont;
    }

    window.webkitRequestFileSystem(window.TEMPORARY, 1024, function(fs) {

        var f1 = "file.html";
        var baseUrl = fs.root.toURL();
        var search_string = "?foo=bar";
        var url = baseUrl + f1 + search_string;
        var f1Cnt = buildContent();

        writeFile(f1, f1Cnt, fs, function() {
            window.location.href = url;
        });
            
    }, fail);
	</script>
	</body>
</html>
